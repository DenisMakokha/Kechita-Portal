# üöÄ Kechita Capital Staff Portal - Deployment Guide

## üìã Prerequisites Checklist

Before deployment, ensure you have:
- [x] Node.js 18+ installed
- [x] pnpm installed
- [x] PostgreSQL database
- [x] Git installed
- [x] GitHub account (DenisMakokha / deniswanjala16@gmail.com)

---

## üõë STEP 1: Stop Running Servers (MANUAL)

**‚ö†Ô∏è IMPORTANT: You must manually stop the running servers first!**

### How to Stop Servers in VSCode:

1. Look at the **TERMINAL** panel at the bottom of VSCode
2. You should see 3 active terminals running:
   - `pnpm --filter @kechita/api dev` (Port 4000)
   - `pnpm --filter @kechita/api dev` (duplicate)
   - `pnpm --filter @kechita/web dev` (Port 5174)

3. **For each terminal:**
   - Click on the terminal to focus it
   - Press `Ctrl + C` to stop the process
   - OR click the üóëÔ∏è (trash) icon on the right to kill the terminal

4. **Verify all stopped:**
   - No processes should be running
   - All terminal output should have stopped

---

## üîß STEP 2: Generate Prisma Client

After stopping the servers, run these commands:

```bash
# Navigate to database package
cd packages/db

# Generate Prisma Client
pnpm prisma generate

# Expected output:
# ‚úî Generated Prisma Client to ./node_modules/@prisma/client
```

**If you see errors:**
- Make sure all terminals are stopped
- Try closing and reopening VSCode
- Run: `pnpm install` first

---

## üß™ STEP 3: Run Test Suite

```bash
# Navigate to API directory
cd ../../apps/api

# Run all tests
pnpm test

# Expected output:
# PASS  src/modules/auth/__tests__/auth.test.ts
#   Authentication Module
#     User Authentication
#       ‚úì should create a user with hashed password
#       ‚úì should verify password correctly
#       ‚úì should enforce unique email constraint
#       ‚úì should track failed login attempts
#       ‚úì should lock account after 5 failed attempts
#       ‚úì should reset failed attempts on successful login
#       ‚úì should use test utility to create user
#       ‚úì should generate auth token
#
# Test Suites: 2 passed, 2 total
# Tests:       8 passed, 8 total
```

### Run Tests with Coverage

```bash
pnpm test:coverage

# This will generate:
# - Console coverage report
# - HTML report in apps/api/coverage/index.html
# - LCOV report for CI/CD
```

### View Coverage Report

```bash
# Open HTML coverage report in browser
start coverage/index.html    # Windows
open coverage/index.html     # macOS
xdg-open coverage/index.html # Linux
```

---

## üêô STEP 4: Initialize Git & Push to GitHub

### 4.1 Initialize Git Repository

```bash
# Go to project root
cd ../..

# Initialize git (if not already done)
git init

# Configure git user (if not configured globally)
git config user.name "Denis Makokha"
git config user.email "deniswanjala16@gmail.com"

# Add all files
git add .

# Create initial commit
git commit -m "feat: Complete Kechita Capital Staff Portal

- Backend: 10 modules, 140+ API endpoints
- Frontend: 30+ pages (Admin + Staff portal)
- Mobile: React Native app (iOS & Android)
- Database: 38 Prisma models
- Testing: Jest, 8 unit tests, CI/CD pipeline
- Documentation: Complete guides and API docs

Features:
- Authentication & Authorization (JWT + RBAC)
- Recruitment Management
- Leave Management
- Claims Processing
- Staff Loans (14th/15th)
- Petty Cash Management
- Performance KPIs
- Document Management
- Communication System
- Admin Panel with Audit Logs

Tech Stack:
- Backend: Node.js, Express, TypeScript, Prisma
- Frontend: React, TypeScript, Vite, TailwindCSS
- Mobile: React Native, Expo
- Database: PostgreSQL
- Testing: Jest, Supertest, Playwright
- CI/CD: GitHub Actions"
```

### 4.2 Create GitHub Repository

**Option A: Via GitHub Web Interface**

1. Go to: https://github.com/new
2. Fill in details:
   - **Owner**: DenisMakokha
   - **Repository name**: Kechita-Portal
   - **Description**: Enterprise HR Staff Portal for Kechita Capital - Full-stack application with Web and Mobile platforms
   - **Visibility**: 
     - Public (if you want to showcase it)
     - Private (for internal use)
   - **DO NOT** initialize with:
     - ‚ùå README (we have one)
     - ‚ùå .gitignore (we have one)
     - ‚ùå License (add later if needed)
3. Click "Create repository"

**Option B: Via GitHub CLI (if installed)**

```bash
gh repo create Kechita-Portal --public --source=. --remote=origin --description="Enterprise HR Staff Portal for Kechita Capital"
```

### 4.3 Push to GitHub

```bash
# Add GitHub remote
git remote add origin https://github.com/DenisMakokha/Kechita-Portal.git

# Verify remote
git remote -v

# Push to main branch
git branch -M main
git push -u origin main
```

**If you get authentication errors:**

```bash
# Use Personal Access Token (PAT)
# 1. Go to: https://github.com/settings/tokens
# 2. Click "Generate new token (classic)"
# 3. Select scopes: repo, workflow
# 4. Copy the token
# 5. Use it as password when pushing:

git push -u origin main
# Username: DenisMakokha
# Password: <paste your PAT here>
```

### 4.4 Verify GitHub Push

1. Go to: https://github.com/DenisMakokha/Kechita-Portal
2. You should see:
   - ‚úÖ All project files
   - ‚úÖ README.md displayed
   - ‚úÖ CI/CD workflow in ".github/workflows"
   - ‚úÖ First CI/CD run should start automatically

---

## üîÑ STEP 5: Configure GitHub Secrets (Optional)

For full CI/CD functionality, add these secrets:

1. Go to: https://github.com/DenisMakokha/Kechita-Portal/settings/secrets/actions
2. Click "New repository secret"
3. Add the following:

### Required Secrets

| Secret Name | Description | How to Get |
|-------------|-------------|------------|
| `DATABASE_URL` | Production database URL | Your PostgreSQL connection string |
| `JWT_SECRET` | JWT signing secret | Generate: `openssl rand -base64 32` |

### Optional Secrets

| Secret Name | Description | How to Get |
|-------------|-------------|------------|
| `SNYK_TOKEN` | Security scanning | Sign up at snyk.io |
| `CODECOV_TOKEN` | Coverage reporting | Sign up at codecov.io |
| `VERCEL_TOKEN` | Frontend deployment | Get from vercel.com |
| `HEROKU_API_KEY` | Backend deployment | Get from heroku.com |

---

## üìä STEP 6: Monitor CI/CD Pipeline

### View Workflow Run

1. Go to: https://github.com/DenisMakokha/Kechita-Portal/actions
2. Click on the first workflow run
3. Watch it execute:
   - ‚úÖ Install dependencies
   - ‚úÖ Run linter
   - ‚úÖ Setup database
   - ‚úÖ Run tests
   - ‚úÖ Build applications
   - ‚úÖ Upload coverage
   - ‚úÖ Security scan

### Expected Results

```
‚úì Test & Build (5-10 minutes)
  ‚úì Checkout code
  ‚úì Setup Node.js
  ‚úì Install pnpm
  ‚úì Install dependencies
  ‚úì Lint code
  ‚úì Setup database
  ‚úì Run backend tests (8 passed)
  ‚úì Run frontend tests
  ‚úì Build backend
  ‚úì Build frontend
  ‚úì Upload coverage

‚úì Security Scan (2-3 minutes)
  ‚úì npm audit
  ‚úì Snyk scan (if configured)
```

---

## üéØ POST-DEPLOYMENT TASKS

### 1. Add Project Badges

Add these to the top of README.md:

```markdown
![CI/CD](https://github.com/DenisMakokha/Kechita-Portal/workflows/CI/CD%20Pipeline/badge.svg)
![Coverage](https://codecov.io/gh/DenisMakokha/Kechita-Portal/branch/main/graph/badge.svg)
![Tests](https://img.shields.io/badge/tests-8%20passed-success)
![License](https://img.shields.io/badge/license-MIT-blue)
```

### 2. Set Up Branch Protection

1. Go to: Settings ‚Üí Branches
2. Add rule for `main` branch:
   - ‚úÖ Require pull request reviews
   - ‚úÖ Require status checks to pass
   - ‚úÖ Require branches to be up to date
   - ‚úÖ Include administrators

### 3. Enable GitHub Pages (Optional)

1. Go to: Settings ‚Üí Pages
2. Source: Deploy from a branch
3. Branch: main / docs
4. Use for project documentation

### 4. Configure Dependabot

Create `.github/dependabot.yml`:

```yaml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10
```

---

## üöÄ DEPLOYMENT OPTIONS

### Backend Deployment

**Option 1: Heroku**
```bash
# Install Heroku CLI
npm install -g heroku

# Login
heroku login

# Create app
heroku create kechita-api

# Add PostgreSQL
heroku addons:create heroku-postgresql:standard-0

# Deploy
git push heroku main
```

**Option 2: AWS/Azure/GCP**
- Use GitHub Actions to deploy
- Configure secrets for cloud credentials
- Update `.github/workflows/ci.yml` with deployment steps

### Frontend Deployment

**Option 1: Vercel** (Recommended)
```bash
# Install Vercel CLI
npm install -g vercel

# Login
vercel login

# Deploy
cd apps/web
vercel --prod
```

**Option 2: Netlify**
```bash
# Install Netlify CLI
npm install -g netlify-cli

# Login
netlify login

# Deploy
cd apps/web
netlify deploy --prod
```

### Mobile App Deployment

**iOS (App Store)**
```bash
cd apps/mobile
expo build:ios
expo upload:ios
```

**Android (Play Store)**
```bash
cd apps/mobile
expo build:android
expo upload:android
```

---

## üìã VERIFICATION CHECKLIST

Before considering deployment complete:

### Code Quality
- [ ] All TypeScript errors resolved
- [ ] Linter passes with no errors
- [ ] No console.log in production code
- [ ] Environment variables configured

### Testing
- [ ] All tests pass locally
- [ ] Coverage meets thresholds (80%+)
- [ ] CI/CD tests pass
- [ ] E2E tests configured

### Security
- [ ] Dependencies audited (npm audit)
- [ ] Secrets not committed to git
- [ ] API endpoints secured
- [ ] Database credentials protected

### Documentation
- [ ] README.md complete
- [ ] API documentation up to date
- [ ] Deployment guide available
- [ ] User guide written

### GitHub
- [ ] Repository created
- [ ] Code pushed successfully
- [ ] CI/CD pipeline runs
- [ ] Secrets configured
- [ ] Branch protection enabled

---

## üÜò TROUBLESHOOTING

### Issue: Tests Fail with Prisma Error

**Solution:**
```bash
# Regenerate Prisma Client
cd packages/db
pnpm prisma generate

# Clear node_modules and reinstall
cd ../..
rm -rf node_modules
pnpm install
```

### Issue: Git Push Rejected

**Solution:**
```bash
# Pull latest changes first
git pull origin main --rebase

# Then push
git push origin main
```

### Issue: CI/CD Fails

**Solution:**
1. Check workflow file syntax
2. Verify all secrets are configured
3. Check database connection in CI
4. Review error logs in GitHub Actions

### Issue: Port Already in Use

**Solution:**
```bash
# Windows
netstat -ano | findstr :4000
taskkill /PID <PID> /F

# macOS/Linux
lsof -ti:4000 | xargs kill -9
```

---

## üìû SUPPORT

For issues or questions:
- **Developer**: Denis Makokha
- **Email**: deniswanjala16@gmail.com
- **GitHub**: @DenisMakokha

---

## üéâ SUCCESS!

Once all steps are complete, you will have:

‚úÖ Tests passing locally  
‚úÖ Code pushed to GitHub  
‚úÖ CI/CD pipeline running  
‚úÖ Coverage reports generated  
‚úÖ Security scanning active  
‚úÖ Ready for production deployment  

**Congratulations on completing the Kechita Capital Staff Portal!** üéä
